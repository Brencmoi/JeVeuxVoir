<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu du Morpion - R√©tro Arcade</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        /* --- STYLE GENERAL RETRO --- */
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #000; /* Fond noir */
            color: #00FF00; /* Texte vert fluo */
        }
        
        .game-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .game-title {
            color: #00FF00;
            text-shadow: 0 0 8px #00FF00; /* Effet de lueur plus prononc√© */
            margin-bottom: 2rem;
            font-size: 2rem; /* L√©g√®rement ajust√© */
        }
        
        /* Styles des boutons du jeu */
        .game-btn {
            font-family: 'Press Start 2P', cursive;
            border-radius: 0; 
            border: 2px solid;
            transition: all 0.1s ease-in-out;
        }

        /* Effet "pushed" */
        .game-btn:active {
            transform: translateY(2px);
            box-shadow: none !important;
        }

        /* --- BOUTON RETOUR : Fixe et discret --- */
        .back-button {
            position: fixed;
            top: 15px; 
            left: 15px;
            z-index: 1000;
            border-radius: 50%; 
            width: 45px; /* Taille l√©g√®rement augment√©e */
            height: 45px; 
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(30, 30, 30, 0.7); 
            border: 2px solid rgba(0, 255, 0, 0.3); /* Bordure plus visible */
            color: rgba(0, 255, 0, 0.8); /* Ic√¥ne plus visible */
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 1.5rem; /* Ic√¥ne plus grande */
        }
        .back-button:hover {
            background-color: rgba(50, 50, 50, 0.9); 
            color: #00FF00; 
            border-color: #00FF00; 
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.7); 
            transform: scale(1.05);
        }

        /* --- STYLES SP√âCIFIQUES AU MORPION --- */
        #board-tictactoe { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 5px; /* Espacement r√©duit pour un look plus "bloqu√©" */
            margin-bottom: 1.5rem;
            border: 4px solid #00FF00; /* Bordure plus √©paisse pour l'√©cran de jeu */
            padding: 5px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5); /* Grosse lueur */
        }
        
        .cell-tictactoe {
            width: 90px; /* L√©g√®rement plus petit pour mieux s'adapter */
            height: 90px;
            background: #0a0a0a; /* Noir tr√®s l√©ger pour la texture */
            border: 2px solid #008f00; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem; /* Symbole plus grand */
            cursor: pointer;
            transition: all 0.1s ease;
        }
        .cell-tictactoe:hover { 
            background: #111; 
            border-color: #00FF00;
            box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.5); /* Effet d'int√©rieur lumineux */
        }
        .cell-tictactoe.X { 
            color: #00FF00; 
            text-shadow: 0 0 3px #00FF00; /* Lueur sur le X */
        } 
        .cell-tictactoe.O { 
            color: #FFD700; /* Or/Jaune pour l'O */
            text-shadow: 0 0 3px #FFD700; /* Lueur sur le O */
        }
        
        #status-tictactoe {
            font-size: 1.2rem;
            min-height: 2.5em; 
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 5px #fff;
        }
    </style>
</head>
<body data-bs-theme="dark">

    <a href="jeux.html" class="back-button" title="Retour au menu des jeux">
        <i class="bi bi-controller"></i>
    </a>
    
    <div id="game-tictactoe-container" class="game-section">
        <div id="game-tictactoe" class="text-center">
            <h1 class="game-title">MORPION üëæ</h1>
            
            <div id="tictactoe-mode-selection" class="mb-4 d-grid gap-2 col-10 col-sm-8 col-md-6 mx-auto">
                <button class="btn btn-outline-success game-btn" data-mode="pvc">VS ROBOT (IA)</button>
                <button class="btn btn-outline-warning game-btn" data-mode="pvp">VS JOUEUR (2P)</button>
            </div>
            
            <div id="board-tictactoe" style="display: none;" class="mx-auto"></div>
            
            <p id="status-tictactoe" class="my-4"></p>
            
            <button id="restart-tictactoe" class="btn btn-outline-info game-btn" style="display: none;">REJOUER</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const boardTicTacToeEl = document.getElementById('board-tictactoe');
            const statusTicTacToeEl = document.getElementById('status-tictactoe');
            const restartBtnTicTacToeEl = document.getElementById('restart-tictactoe');
            const modeSelectionEl = document.getElementById('tictactoe-mode-selection');

            let cellsTicTacToe = [], currentPlayer, gameActive, boardState, gameMode;
            const winningConditions = [ [0,1,2], [3,4,5], [6,7,8], [0,3,6], [1,4,7], [2,5,8], [0,4,8], [2,4,6] ];

            // Initialise l'affichage au mode s√©lection
            function initTicTacToe() {
                modeSelectionEl.style.display = 'grid'; // Utilise grid pour le d-grid-gap de Bootstrap
                boardTicTacToeEl.style.display = 'none';
                restartBtnTicTacToeEl.style.display = 'none';
                statusTicTacToeEl.textContent = 'SELECTIONNEZ UN MODE DE JEU';
            }

            // G√®re le choix du mode
            modeSelectionEl.querySelectorAll('button').forEach(btn => btn.addEventListener('click', () => {
                gameMode = btn.dataset.mode;
                startTicTacToe();
            }));

            // D√©marre la partie
            function startTicTacToe() {
                modeSelectionEl.style.display = 'none';
                boardTicTacToeEl.style.display = 'grid';
                restartBtnTicTacToeEl.style.display = 'inline-block';
                boardTicTacToeEl.innerHTML = '';
                cellsTicTacToe = [];
                boardState = ["", "", "", "", "", "", "", "", ""];
                currentPlayer = 'X';
                gameActive = true;
                
                // Adapte le message de statut
                if (gameMode === 'pvc') {
                    statusTicTacToeEl.textContent = `JOUEUR X (VOUS)`;
                } else {
                    statusTicTacToeEl.textContent = `JOUEUR X`;
                }
                
                // Cr√©e les cellules
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell-tictactoe');
                    cell.dataset.index = i;
                    cell.addEventListener('click', handleCellClick);
                    boardTicTacToeEl.appendChild(cell);
                    cellsTicTacToe.push(cell);
                }
            }
            
            // G√®re le clic sur une cellule
            function handleCellClick(e) {
                const clickedCell = e.target;
                const clickedCellIndex = parseInt(clickedCell.dataset.index);

                // Ne joue pas si la case est d√©j√† prise ou si le jeu est inactif
                if (boardState[clickedCellIndex] !== "" || !gameActive) return; 
                // Ne joue pas si c'est JvC et que c'est le tour du robot
                if (gameMode === 'pvc' && currentPlayer === 'O') return;

                placeMark(clickedCellIndex, currentPlayer);

                // Si JvC et que le tour passe au robot (O)
                if (gameActive && gameMode === 'pvc' && currentPlayer === 'O') { 
                    boardTicTacToeEl.style.pointerEvents = 'none'; // D√©sactive les clics
                    statusTicTacToeEl.textContent = `ROBOT (O) REFLECHIT...`;
                    setTimeout(() => {
                        robotMove();
                        boardTicTacToeEl.style.pointerEvents = 'auto'; // R√©active les clics
                    }, 600); 
                }
            }

            // Place la marque sur le plateau et v√©rifie le r√©sultat
            function placeMark(index, player) {
                if (!gameActive || index < 0 || index > 8 || boardState[index] !== "") return; 
                
                boardState[index] = player;
                cellsTicTacToe[index].textContent = player;
                cellsTicTacToe[index].classList.remove('X', 'O');
                cellsTicTacToe[index].classList.add(player);
                checkResult(); 
            }

            // Logique de l'IA (inchang√©e, mais bonne !)
            function robotMove() {
                if (!gameActive || currentPlayer !== 'O') return; 

                let move = -1;
                
                // 1. Tenter de gagner
                for(let i = 0; i < 9; i++) {
                    if(boardState[i] === "") {
                        boardState[i] = 'O';
                        if(checkWin('O')) { move = i; }
                        boardState[i] = ""; 
                        if(move !== -1) break;
                    }
                }
                // 2. Tenter de bloquer l'adversaire (X)
                if (move === -1) {
                    for(let i = 0; i < 9; i++) {
                        if(boardState[i] === "") {
                            boardState[i] = 'X';
                            if(checkWin('X')) { move = i; }
                            boardState[i] = ""; 
                            if(move !== -1) break;
                        }
                    }
                }
                // 3. Centre (case 4)
                if (move === -1 && boardState[4] === "") move = 4;
                // 4. Coins
                if (move === -1) {
                    const corners = [0, 2, 6, 8];
                    const availableCorners = corners.filter(i => boardState[i] === "");
                    if (availableCorners.length > 0) {
                        move = availableCorners[Math.floor(Math.random() * availableCorners.length)];
                    }
                }
                // 5. C√¥t√©s restants (si tout le reste √©choue, joue au hasard)
                if (move === -1) {
                    const available = [];
                    for(let i=0; i<9; i++) { if(boardState[i]==='') available.push(i); }
                    if (available.length > 0) {
                        move = available[Math.floor(Math.random() * available.length)];
                    }
                }

                if(move !== -1) {
                    placeMark(move, 'O');
                } else {
                    // C'est l'√©galit√© (sauf s'il y a un bug IA)
                    console.error("Le robot n'a pas trouv√© de coup valide ! (√âgalit√©?)");
                    gameActive = false; 
                    statusTicTacToeEl.textContent = "√âgalit√©! (Erreur IA si non complet)";
                }
            }

            // V√©rifie les conditions de victoire/√©galit√©
            function checkResult() {
                let roundWon = false;
                let winningPlayer = ''; 

                // Check pour la victoire
                for (let i = 0; i < winningConditions.length; i++) {
                    const [a, b, c] = winningConditions[i];
                    if (boardState[a] === '' || boardState[b] === '' || boardState[c] === '') continue;
                    if (boardState[a] === boardState[b] && boardState[b] === boardState[c]) {
                        roundWon = true;
                        winningPlayer = boardState[a]; 
                        // Optionnel : Ajouter un style de victoire aux 3 cellules
                        cellsTicTacToe[a].style.backgroundColor = '#008f00'; 
                        cellsTicTacToe[b].style.backgroundColor = '#008f00';
                        cellsTicTacToe[c].style.backgroundColor = '#008f00';
                        break;
                    }
                }

                if (roundWon) {
                    statusTicTacToeEl.textContent = `${winningPlayer} a GAGN√â ! üèÜ`;
                    gameActive = false;
                    return; 
                }

                // Check pour l'√©galit√©
                if (!boardState.includes("")) {
                    statusTicTacToeEl.textContent = `EGALIT√â ! ü§ù`;
                    gameActive = false;
                    return; 
                }

                // Si le jeu continue, change de joueur et met √† jour le statut
                currentPlayer = currentPlayer === "X" ? "O" : "X";
                let statusText = `AU TOUR DE ${currentPlayer}`;
                if (gameMode === 'pvc') {
                    statusText = currentPlayer === 'X' ? `JOUEUR X (VOUS)` : `ROBOT O`;
                }
                statusTicTacToeEl.textContent = statusText;
            }

            // Fonction utilitaire pour l'IA (check de victoire sans effet secondaire)
            function checkWin(player) {
                return winningConditions.some(condition => {
                    return condition.every(index => boardState[index] === player);
                });
            }
            
            // G√®re le bouton Rejouer
            restartBtnTicTacToeEl.addEventListener('click', initTicTacToe);

            // --- Lancement du jeu au chargement ---
            initTicTacToe();

        });
    </script>

</body>
</html>